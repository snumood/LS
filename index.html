<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>생활습관점수표 - 분당서울대학교병원</title>
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
  <style>
    :root { 
      --primary: #4F46E5; 
      --primary-light: #EEF2FF; 
      --text: #1F2937; 
      --bg: #F9FAFB; 
    }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { font-family: 'Pretendard', sans-serif; background: var(--bg); color: var(--text); padding: 20px 16px; margin: 0; }
    .container { max-width: 640px; margin: 0 auto; }
    header { text-align: center; margin-bottom: 30px; }
    
    /* 카드 디자인 */
    .question-card, .patient-card { 
      background: white; 
      border-radius: 16px; 
      padding: 24px; 
      margin-bottom: 20px; 
      box-shadow: 0 4px 6px rgba(0,0,0,0.05); 
    }

    /* 환자 ID 입력란 스타일 */
    .input-label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.95rem; }
    .text-input { width: 100%; padding: 14px; border-radius: 12px; border: 2px solid #E5E7EB; font-size: 1rem; }
    .input-hint { font-size: 0.85rem; color: #6B7280; margin-top: 6px; display: block; }
    
    /* 질문지 공통 스타일 */
    .question-title { font-weight: 600; margin-bottom: 16px; font-size: 1.1rem; }
    .options { display: flex; flex-direction: column; gap: 10px; }
    .option-label { display: flex; padding: 14px; background: var(--bg); border: 2px solid transparent; border-radius: 12px; cursor: pointer; font-size: 0.95rem; align-items: center; }
    .option-radio { margin-right: 12px; width: 20px; height: 20px; flex-shrink: 0; }
    .option-label:has(.option-radio:checked) { background: var(--primary-light); border-color: var(--primary); font-weight: 600; }
    .btn-submit { width: 100%; padding: 18px; background: var(--primary); color: white; border: none; border-radius: 16px; font-size: 1.1rem; font-weight: 700; cursor: pointer; }
    .score-badge { margin-left: auto; color: var(--primary); font-size: 0.85rem; font-weight: bold; }
    
    /* 결과 화면 스타일 */
    #result { display: none; text-align: center; background: white; padding: 40px 24px; border-radius: 24px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); margin-top: 20px; }
    .score-val { font-size: 4rem; font-weight: 800; color: var(--primary); margin: 20px 0; }
    .result-msg-box { padding: 24px; border-radius: 16px; line-height: 1.8; font-size: 1.05rem; text-align: left; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1 style="font-size: 1.8rem; font-weight: 800;">생활습관점수표</h1>
      <p style="color: #6B7280;">지난 한 달간의 습관을 체크해 주세요.</p>
    </header>

    <form id="lifestyleForm">
      <div class="patient-card">
        <label class="input-label">등록번호 또는 이니셜+생년월일</label>
        <input type="text" id="patientID" class="text-input" placeholder="여기에 입력하세요" required>
        <span class="input-hint">예: 43445678 또는 HGD19990305</span>
      </div>

      <div id="questions-area">
        <div class="question-card">
          <div class="question-title">01. 꾸준한 약물 복용</div>
          <div class="options">
            <label class="option-label"><input type="radio" name="q1" value="40" class="option-radio" required><span>의사 지시대로 규칙적 복용</span><span class="score-badge">40점</span></label>
            <label class="option-label"><input type="radio" name="q1" value="20" class="option-radio"><span>한두 번 놓쳤지만 거의 복용</span><span class="score-badge">20점</span></label>
            <label class="option-label"><input type="radio" name="q1" value="10" class="option-radio"><span>일주일 정도 못 했지만 나머지 복용</span><span class="score-badge">10점</span></label>
            <label class="option-label"><input type="radio" name="q1" value="0" class="option-radio"><span>일주일 이상 복용하지 않음</span><span class="score-badge">0점</span></label>
          </div>
        </div>
        
        <div class="question-card">
          <div class="question-title">09. 스스로를 아껴 주기</div>
          <div class="options">
            <label class="option-label"><input type="radio" name="q9" value="5" class="option-radio" required><span>자신을 격려하고 아껴줌</span><span class="score-badge">5점</span></label>
            <label class="option-label"><input type="radio" name="q9" value="3" class="option-radio"><span>자책해도 곧 너그러워짐</span><span class="score-badge">3점</span></label>
            <label class="option-label"><input type="radio" name="q9" value="1" class="option-radio"><span>완벽주의와 자책이 잦음</span><span class="score-badge">1점</span></label>
            <label class="option-label"><input type="radio" name="q9" value="0" class="option-radio"><span>자기를 비난하며 지냄</span><span class="score-badge">0점</span></label>
          </div>
        </div>
      </div>

      <button type="submit" id="submitBtn" class="btn-submit">제출 및 결과 보기</button>
    </form>

    <div id="result">
      <h3>이번 달 나의 점수</h3>
      <div id="totalScore" class="score-val">0</div>
      <div id="msg" class="result-msg-box"></div>
      <button onclick="location.reload()" style="margin-top:20px; background:#94a3b8; border:none; color:white; padding:12px 24px; border-radius:10px; cursor:pointer; font-weight:600;">다시 하기</button>
    </div>
  </div>

  <script>
    const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzW4wgHg-6pHLIhXPro5KfrKPWqm-WeeojcRkC3DH05wjrBWUfbT7D--yD2FXLY1tcm/exec';

    document.getElementById('lifestyleForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const btn = document.getElementById('submitBtn');
      btn.disabled = true;
      btn.textContent = "데이터 저장 중...";

      let totalScore = 0;
      let answers = {};
      for (let i = 1; i <= 9; i++) {
        const selected = document.querySelector(`input[name="q${i}"]:checked`);
        if(selected) {
          const val = selected.value;
          totalScore += parseInt(val);
          answers[`q${i}`] = val;
        }
      }

      try {
        await fetch(GOOGLE_SCRIPT_URL, {
          method: 'POST',
          mode: 'no-cors',
          body: JSON.stringify({
            patientID: document.getElementById('patientID').value,
            totalScore: totalScore,
            answers: answers
          })
        });

        // 결과 화면 전환 및 메시지 출력
        document.getElementById('lifestyleForm').style.display = 'none';
        const resultDiv = document.getElementById('result');
        resultDiv.style.display = 'block';
        document.getElementById('totalScore').textContent = totalScore;
        
        const msg = document.getElementById('msg');
        if (totalScore >= 80) {
          msg.style.background = "#ECFDF5"; 
          msg.style.color = "#10B981";
          msg.innerHTML = "<strong>훌륭합니다!</strong> 안정적으로 잘 관리하고 계시네요. 항상 좋은 생활 습관을 유지하세요!";
        } else {
          msg.style.background = "#FEF2F2"; 
          msg.style.color = "#EF4444";
          msg.innerHTML = "<strong>조금 더 힘내세요!</strong> 좋은 생활 습관이 병을 극복하고 유지하는데 중요합니다.";
        }
        window.scrollTo(0, 0);

      } catch (err) {
        alert("오류가 발생했습니다: " + err.message);
        btn.disabled = false;
        btn.textContent = "제출 및 결과 보기";
      }
    });
  </script>
</body>
</html>

